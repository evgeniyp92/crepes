# Build notes part 2

## Handling stray api requests

If you have a request that makes it past all your routes you should then have a catch-all route to respond with a 404

Instead of declaring a bunch of `app.verbs` you can just use `app.all()`

```javascript
app.all('*', (request, response, next) => {
    response.status(404).json({
        status: 'fail',
        message: `Route ${request.originalUrl} does not exist`,
    });
});
```

## Express error handling

Important to distinguish btwn two types of errors

-   Operational
-   Programming

Operational errors are ones that we can predict and control for, usually this boils to everything that is not PEBKAC

Programming errors are basically PEBKAC type stuff

Also, exceptions and errors are interchangeable

Express actually comes with error handling out of the box, so we can just write a global middleware to handle our error signaling that can accept error signals from anywhere in the app

Global error handling middleware enables us to maintain good separation of concerns btwn business logic and applicatin logic

Here is an example of a better error handling mechanism than the one above

```javascript
// Controlling for a route that isnt handled by any router listed above
app.all('*', (request, response, next) => {
    // response.status(404).json({
    //   status: 'fail',
    //   message: `Route ${request.originalUrl} does not exist`,
    // });

    const error = new Error(
        `Requested route ${request.originalUrl} does not exist`
    );
    error.status = 'fail';
    error.statusCode = 404;

    // passing an error to next() will cause it to go to our error handler
    next(error);
});

app.use((error, request, response, next) => {
    // eslint-disable-next-line no-param-reassign
    error.statusCode = error.statusCode || 500;
    // eslint-disable-next-line no-param-reassign
    error.status = error.status || 'Unknown error';

    response.status(error.statusCode).json({
        status: error.status,
        message: error.message,
    });
});
```
